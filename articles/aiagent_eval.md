---
title: "AIエージェントのテスト・評価方法を考えてみた"
emoji: "🦾"
type: "tech"
topics: ["ai", "aiエージェント", "autogen", "test", "評価"]
published: true
published_at: 2025-09-30 06:00
publication_name: "secondselection"
---

## はじめに

現在、私は**autogen**を用いたマルチエージェントシステムの構築に取り組んでいます。
AIエージェントに関する話題は多くありますが、実際に構築を進める中でさまざまな課題に直面しました。
詳しくは後述しますが、主な課題は「**エージェントが期待どおりに動かない**」点です。
そこで、課題に対応するための評価方法を検討し、客観的な評価をすることにしました。
これにより問題の所在を明確にし、効率的な改善につなげることを期待します。
本記事では、**ディベートをするマルチエージェントシステム**を題材に、
エージェントの設計・評価方法について記載します。
ディベートのテーマは「テレビCMとYouTube広告のどちらが有効か」とします。

:::details autogenとは
Microsoftが開発したオープンソースのAIエージェント開発フレームワークです。

:::

autogenの詳細については下記記事を参照ください。

https://zenn.dev/secondselection/articles/ai_articles_generator

## マルチエージェントシステムについて

ここで一度マルチエージェントシステムの定義についておさらいします。

> 複数のエージェントから構成されるシステムであり、個々のエージェントやモノリシックなシステムでは困難な課題をシステム全体として達成する。

[引用元](https://ja.wikipedia.org/wiki/%E3%83%9E%E3%83%AB%E3%83%81%E3%82%A8%E3%83%BC%E3%82%B8%E3%82%A7%E3%83%B3%E3%83%88%E3%82%B7%E3%82%B9%E3%83%86%E3%83%A0)

難しいことが書かれていますが、シングルエージェントが協力して課題を達成するシステムを
指します。

![alt text](/images/single.png)
画像のような単一のエージェントのことをシングルエージェントと言います。
ツールが用意されている場合、エージェントはツールを利用することが出来ます。
今回は議論の内容を整理し、適切な進行をしてほしいので、議論を記録しておくツールを用意しました。

![alt text](/images/mulch.png)
司会者、テレビ局の社長、人気YouTuber、消費者の4つのエージェントを用意しました。
司会者が進行をして、その他のエージェントが立場に沿った議論をすることを期待します。
ディベートの際に司会者が進行ではなく、議論に参加するなどの行為をするとディベートがうまくいきません。
このようにマルチエージェントシステムがうまく動作するにはシングルエージェントが正しく
動作する前提を必要とします。
エージェント設計をする際は人間におきかえて考えると効果的です。

### エージェント設計

マルチエージェントシステムを構築するにあたって、エージェントの設計を整理しておくと便利です。
ドキュメントになるだけでなく、評価をする際に要件を見たしているかの基準になります。

### ツール

今回のシステムでエージェントごとに与えるツールを整理します。
司会者には議論記録ツール、それ以外にはWeb検索ツールを与えます。

| ツール名 | 🎤 司会者 | 📺 テレビ局の社長 | 📱 人気YouTuber | 👩‍👦 消費者代表（子育て主婦） |
|---------------------------|----------------|----------------------|---------------------------|---|
| Web検索ツール |      ❌         |      ✅                |       ✅  | ✅  |
| 議論記録ツール | ✅              |     ❌                 |      ❌                     | ❌ |

### 設計

エージェントごとの人格や、行動基準を定義していきます。
設定項目を揃えておくと管理が楽になります。
ここでいう設計はシステムプロンプトと同義だと考えてください。
ツール利用を許可する場合は利用方法を記載しておくことがポイントになります。

#### 🎤 司会者

| 項目             | 司会者 |
|------------------|---------------------------|
| **目的**         | 公平で整理された議論を進行し、理解しやすい場を提供 |
| **役割**         | 発言順と時間を管理し、論点を整理 |
| **価値観**       | 公平性・中立性・透明性 |
| **ツール利用ポリシー** | 定期的に議論を記録するツールを利用 |

#### 📺 テレビ局の社長

| 項目             | テレビ局の社長 |
|------------------|------------------|
| **目的**         | テレビCMの影響力と信頼性を証明し、広告の王道としての価値を示す |
| **役割**         | 歴史とデータに基づきテレビ広告の優位性を主張 |
| **価値観**       | 信頼性・伝統 |
| **ツール利用ポリシー** | テレビCMの優れている点をWeb検索 |

#### 📱 人気YouTuber

| 項目             | 人気YouTuber |
|------------------|----------------|
| **目的**         | YouTube広告と個人発信の強みを示し、現代に適した広告手法を主張 |
| **役割**         | 実体験やSNS事例で現代的視点をリード |
| **価値観**       | 即時性・拡散性・双方向性 |
| **ツール利用ポリシー** | YouTube広告の優れている点をWeb検索 |

#### 👩‍👦 消費者代表（子育て主婦）

| 項目             | 消費者代表（子育て主婦） |
|------------------|------------------------------|
| **目的**         | 生活者の実感をベースに、意見を率直に伝える |
| **役割**         | 消費者のリアルな声を届ける |
| **価値観**       | 共感・実用性・子供への影響 |
| **ツール利用ポリシー** | 消費者の声をWeb検索し、代弁する |

### エージェントが期待通りに動かない

各エージェントの設計が完了し、いざマルチエージェントで動作検証をしてみると思っていたのと違うことがあります。
私はやみくもにプロンプトを修正し、検証をしていたのですが、一向に精度が改善しませんでした。
この手法はエラーメッセージを見ずにデバッグをしているのと同じで、非効率です。
そこで役立つのが今回考えた評価方法になります。

## 評価について

エージェントごとの評価指標を作成し、それをベースにAIエージェントの出力を評価します。
ポイントとしてはシングルエージェントで品質担保してから、マルチエージェントに移行
することです。より小さくシンプルに。

### シングルエージェントの評価(ツールなし)

評価をしやすくするためにツール利用と、ツールなしで評価は分けます。この段階ではエージェントが与えられた人格に従って発言が出来ているかを評価します。

#### 人格（再掲）

| 項目             | 消費者代表（子育て主婦） |
|------------------|------------------------------|
| **目的**         | 生活者の実感をベースに、意見を率直に伝える |
| **役割**         | 生活感のあるリアルな声を届ける |
| **価値観**       | 共感・実用性・子供への影響 |
| **ツール利用ポリシー** | 消費者の声をWeb検索し、代表として代弁する |

#### 評価基準

| チェック観点           | 確認内容                           | 判定基準                                                                             |
| ---------------- | ------------------------------ | -------------------------------------------------------------------------------- |
| 子供・家庭への影響を考慮している | 広告や施策が子供や家庭にどう影響するかを意識しているか    | 〇：子供や家庭への影響を具体例で示している<br>△：影響について言及はあるが抽象的<br>×：影響に触れていない                        |
| 共感性のある発言         | 他の生活者や一般消費者が「確かに」と共感できる内容か | 〇：多くの人が共感できる生活のリアルを提示している<br>△：個人の経験にとどまるが理解はできる<br>×：一般消費者が共感しづらい特殊な視点に偏る       |

#### 評価の例

消費者代表（子育て主婦）：「子供に動画を見せているときに、教育に良くない広告が流れてくることがあります。
子供は影響を受けやすいため心配です。動画によって広告を変更してもらえると安心して利用できます」

この発言は子供・家庭への影響を考慮しており、共感性のある発言になっていると考えられます。これで最低限の品質担保が出来たと言えます。この評価を全てのエージェントに対して行います。

### シングルエージェントの評価(ツールあり)

続いて、文脈に沿って適切なツールを利用できているかを評価します。例えば消費者エージェントは、消費者のアンケート情報を検索し利用することが期待されます。

#### ツール利用評価基準

| チェック観点          | 確認内容                       | 判定基準                                                                                  |
| --------------- | -------------------------- | ------------------------------------------------------------------------------------- |
| **ツールを活用しているか** | Web検索ツールを利用し、関連情報を持ち込んでいるか | 〇：検索を行い、調査結果や記事を根拠として引用している<br>△：検索はしているが、引用が抽象的または情報が不明確<br>×：検索を行わず、独自の意見のみ述べている    |
| **検索結果の適切さ**    | 検索Word・取得情報が質問や議題に即しているか    | 〇：質問に合ったキーワードで検索し、関連性の高い情報を提示<br>△：関連はあるが抽象的で、質問に直結していない<br>×：議題から外れた情報を持ち込んでいる       |

#### 評価例

司会者：「では次に、消費者の立場からYouTube広告についての懸念点についてご意見いただけますか？」

消費者代表（子育て主婦）：YouTube広告について消費者の意見をWeb検索→保護者に対するアンケート結果情報を取得。
消費者代表（子育て主婦）：20○○年に行われた調査で、小学生の保護者の約〇割が “不適切な広告を目にした経験がある” と回答しているという結果が出ていました。
私自身も子供にアニメ動画を見せていたとき、突然ゲーム課金や刺激的な映像の広告が流れてしまい、慌てて止めた経験があります。広告の配信基準をもっと厳しくしてほしいです。

この例ではツールを利用して取得した情報が意見に反映できているか、適切な検索結果かを評価します。

### マルチエージェントの評価

シングルエージェントの評価が完了したらマルチエージェントに移行します。厳密に評価する場合、司会者と消費者代表の2エージェントで評価するということも考えられます。
マルチエージェントの評価する際も基本的には同じですが、ディベートの例だとエージェントのやり取りが成立していることが求められます。

| チェック観点          | 確認内容                       | 判定基準                                                                                  |
| --------------- | -------------------------- | ------------------------------------------------------------------------------------- |
| **ツールを活用しているか** | Web検索ツールを利用し、関連情報を持ち込んでいるか | 〇：検索を行い、調査結果や記事を根拠として引用している<br>△：検索はしているが、引用が抽象的または情報が不明確<br>×：検索を行わず、独自の意見のみ述べている    |
| **意見が適切であるか**    | 発言内容が適切であるか    | 〇：議論内容、価値観を踏まえた発言が出来ている<br>△：抽象的で前回と同じような発言をしている<br>×：議論内容、価値観から反れた発言をしている       |
| **相互理解**   | 他エージェントの発言を理解し、要点を踏まえた応答か | 〇：要点を引用・言い換えして応答<br>△：部分的に拾うが浅い<br>×：無関係な応答           |

🎤 司会者
「では次に、“YouTube広告が子供に与える影響”について、消費者代表の方からご意見をお願いします」

📺 テレビ局の社長
「テレビCMでは放送倫理や審査基準があり、子供に悪影響のある内容は基本的に流れません。その点でテレビは安心感があると考えています」

📱 人気YouTuber
「確かにテレビの基準は厳しいですが、YouTubeもAIによる広告チェックを強化してきています。ただ、まだ完全ではなく、時々すり抜けがあるのも事実です」

👩‍👦 消費者代表(子育て主婦)
Web検索で検索したところ、20○○年の調査で保護者の〇割以上が『子供が不適切な広告を目にしたことがある』と答えているという結果が出ていました。
社長がおっしゃった“テレビの信頼性”は、この数字から見ても確かに裏付けられています。一方でYouTuberさんのご意見にある“AI審査の強化”についても、調査では『改善はしているが依然として課題が残る』と指摘されていました。
なので結論としては、両方の意見に共通している“安全性の担保”が重要です。具体的には、家庭で親が広告を選別できる機能をもっと使いやすくすることが現実的な解決策だと考えます。

この過程まで来ると全体としての評価が必要になります。消費者代表の意見をみてみると、チェック観点を全てクリアできていると言えます。

## おわりに

本記事ではディベートのマルチエージェントシステムを題材に評価指標、評価方法を提案しました。
そもそも評価指標・評価方法が適切であるのか等の課題は残りますが、少なくともシステムを完成したと他社に説明できる根拠にはなると考えています。特に小規模なシステムでは今回の手法が有効だと考えます。
大規模なシステムの場合、評価を生成AIに任せたり、評価ツールを利用するなど工夫が必要だといえます。また評価指標・評価方法についても今後ブラッシュアップしていく予定です。